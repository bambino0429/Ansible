---
# This playbook adds EPEL repository to RHEL servers and enable it

  - name: Add and Enable EPEL Repository
    hosts: linux2
    become: yes

    tasks:
      - name: Gather facts
        action: ec2_facts

      - name: Conditional
        action: debug msg="This instance is a t2.micro"
        when: ansible_ec2_instance_type == "t2.micro"

      - name: Conditional 2
        action: debug msg="{{ansible_ec2_instance_id}}"

      - name: Extract tags
        ec2_tag:
          resource: "{{ansible_ec2_instance_id}}"
          region: "{{ ansible_ec2_placement_region }}"
          state: list
        register: instance_tags

      - debug: var=instance_tags

      - name: Install EPEL from the website
        yum: name=http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm state=present

#      - name: Add repository
#        yum_repository:
#          name: epel
#          description: EPEL YUM repo
#          baseurl: http://download.fedoraproject.org/pub/epel/$releasever/$basearch/

#      - name: Install python pip and dev
#        yum: name={{ item }} enablerepo=epel update_cache=yes state=latest
#        with_items:
#          - python-pip
#          - python-dev

      - name: Install python pip
        yum: name=python-pip enablerepo=epel update_cache=yes state=latest

#      - name: Update pip to the latest version
#        command: 'pip install --upgrade pip'

      - name: Install boto using pip
        pip: name=boto
